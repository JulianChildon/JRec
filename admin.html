<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ç®¡ç†å‘˜ç®¡ç†ç«¯</title>
<link rel="stylesheet" href="style.css">
<script src="auth.js"></script>
</head>
<body>

<div id="userBar" style="position:fixed;top:12px;right:12px;z-index:9998;display:flex;gap:10px;align-items:center;background:rgba(15,23,42,.85);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.35)">
  <span style="font-size:14px;color:#8fa1c7">ğŸ‘¤ ç®¡ç†å‘˜ï¼š<strong id="adminName" style="color:#e6ebff">â€¦</strong></span>
  <a id="userMgmtBtn" class="btn" href="admin-users.html" style="display:none;">ç”¨æˆ·ç®¡ç†</a>
  <button id="logoutBtn" class="btn" style="padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.02));color:#e6ebff;cursor:pointer">é€€å‡ºç™»å½•</button>
</div>
<script>
(async () => {
  if (!window.Auth) return;
  const u = await Auth.getSessionUser();
  const nameEl = document.getElementById('adminName');
  if (u && nameEl) nameEl.textContent = u;
  const btn = document.getElementById('logoutBtn');
  if (btn) btn.addEventListener('click', () => Auth.logout(true));
  window.addEventListener('keydown', (e) => {
    if (e.altKey && (e.key === 'l' || e.key === 'L')) {
      e.preventDefault();
      Auth.logout(true);
    }
  });
  // super æ‰æ˜¾ç¤ºç”¨æˆ·ç®¡ç†
  const role = Auth.getUserRole(u || '');
  if (role === 'super') {
    const mg = document.getElementById('userMgmtBtn');
    if (mg) mg.style.display = 'inline-flex';
  }
})();
</script>

<script>if(window.Auth){Auth.requireAuth();}else{window.addEventListener('load',()=>Auth&&Auth.requireAuth());}</script>

<script>document.documentElement.style.visibility='hidden';</script>
<script>window.addEventListener('DOMContentLoaded',()=>{});</script>

<div class="shell">
  <header class="app-header">
    <div class="brand">
      <div class="logo">ğŸ§‘â€ğŸ’¼</div>
      <div>
        <div class="site-title">è´Ÿè´£äººç®¡ç†ç«¯</div>
        <div class="site-sub">æŸ¥çœ‹ä¸ç®¡ç†ç”³è¯·</div>
      </div>
    </div>
    <a href="index.html" class="btn">è¿”å›é¦–é¡µ</a>
  </header>

  <main class="content">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <h3>ç”³è¯·ä¿¡æ¯åˆ—è¡¨</h3>
        <div class="muted" id="applicationCount">0 æ¡ç”³è¯·</div>
      </div>
      <div style="display:flex;gap:10px;">
        <button id="exportJson" class="btn">å¯¼å‡º JSON</button>
        <button id="clearAll" class="btn danger">æ¸…ç©ºæ‰€æœ‰</button>
      </div>
    </div>

    <div class="table-wrap" style="margin-top:12px;">
      <table>
        <thead>
          <tr>
            <th>å­¦å·</th><th>å§“å</th><th>ä¸“ä¸š</th><th>å¹´çº§</th><th>æ„å‘ç¤¾å›¢</th>
            <th>ç”µè¯</th><th>é‚®ç®±</th><th>è‡ªæˆ‘ä»‹ç»</th><th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="applicationsTable">
          <tr><td colspan="8" class="muted">æš‚æ— ç”³è¯·æ•°æ®</td></tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<!-- ç¼–è¾‘å¼¹çª— -->
<div id="modal" class="modal-backdrop" style="display:none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <h3>ç¼–è¾‘ç”³è¯·</h3>
      <form id="editForm">
        <input type="hidden" id="editIndex">
        <label>å­¦å· <input id="editStudentId" required></label>
        <label>å§“å <input id="editName" required></label>
        <label>ä¸“ä¸š <input id="editMajor" required></label>
        <label>å¹´çº§
          <select id="editGrade" required>
            <option>å¤§ä¸€</option><option>å¤§äºŒ</option><option>å¤§ä¸‰</option>
            <option>å¤§å››</option><option>ç ”ç©¶ç”Ÿ</option>
          </select>
        </label>
        <label>ç”µè¯ <input id="editPhone" required></label>
        <label>é‚®ç®± <input id="editEmail" type="email" required></label>
        <label>è‡ªæˆ‘ä»‹ç» <textarea id="editIntroduction" required></textarea></label>
        <label>æ„å‘ç¤¾å›¢ <input id="editClub" required></label>
        <div style="display:flex;gap:12px;justify-content:flex-end;">
          <button type="button" id="closeModal" class="btn">å–æ¶ˆ</button>
          <button type="submit" class="btn primary">ä¿å­˜</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="admin.js"></script>
<script>(async()=>{if(window.Auth){const u=await Auth.getSessionUser();
 if(u){document.documentElement.style.visibility='visible';}})();</script>
</body>
</html>
